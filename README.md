# Data-Analysis-SQL-OnlineRetail-Sale
Analyzed using SQL Queries the Online Retail Sales for different countries
Analysis was done for data in which there was InvoiceNo, StockCode, Product Description, Quantity, InvoiceDate, UnitPrice, CustomerID & Country were given.
Cleaned the file 
Used Transactions to make changes
Analyzed the number of Records, null value checks, and distinct values in the data.
Analyzed the Sales per customer to find out the Top clients which buy from us.
Calculated Sales per Invoice using Quantity and price per unit.
Analyzed Which product is the Top performer and which one is the bottom performer.
Creating Views so that data is restricted.
Finding out Top performing Countries and Bottom Performing Countries so that we can focus on the Bottom performing countries and improve our sales 

use details;

--Viewing the Table that has been imported

--use dbo.[tablename]

--Viewing Distinct InvoiceNo from Table
select distinct InvoiceNo
from dbo.[OnlineRetail];  --{some of the InvoiceNo have C written before them, want to clean it}

--Cleaning the Data

select * from dbo.[OnlineRetail]
where len(InvoiceNo) > 6;  --{Rows in Column InvoiceNo having more than 6 characters}

select count(*)
from dbo.[OnlineRetail]
where len(InvoiceNo) >6; --{Finding out how many rows have string value written before numbers}

--Using Transaction so that If we want to undo any changes we can do it.
BEGIN TRANSACTION

--SAVE TRANSACTION T1
UPDATE dbo.[OnlineRetail]
SET InvoiceNo = SUBSTRING(InvoiceNo, PATINDEX('%[0-9]%', InvoiceNo), LEN(InvoiceNo))
WHERE PATINDEX('%[0-9]%', InvoiceNo) > 1; -- {Updating all the columns with more than 6 characters and keeping only numerical value}

ROLLBACK TRANSACTION T1;

SELECT DISTINCT STOCKCODE
FROM dbo.[OnlineRetail];

select stockcode from dbo.[OnlineRetail]
where stockcode  = '90067';

SELECT STOCKCODE FROM dbo.[OnlineRetail]
where len(stockcode)>5;

select count(Stockcode) from dbo.[OnlineRetail]
where len(stockcode) >5;

select count(*) from dbo.[OnlineRetail];

SELECT DISTINCT DESCRIPTION
FROM dbo.[OnlineRetail];

select count(DISTINCT DESCRIPTION)
FROM dbo.[OnlineRetail];

SELECT DESCRIPTION
FROM dbo.[OnlineRetail];

select distinct customerID from dbo.[OnlineRetail];

--Nos of disinct customers - Total : 4372 unique customers
select count(Distinct customerID) from dbo.[OnlineRetail];

--Total Nos of customers - Total : 4,06,829 CustomerIDs
select count(customerID) from dbo.[OnlineRetail];

--Sales generated per customer as per the items bought
select InvoiceNo , StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID, 
Country, (Quantity * UnitPrice) as Sales_per_customer
from dbo.[OnlineRetail]; 

--Finding out Maximum sales as per sales_per_customer, 
select InvoiceNo , StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID, 
Country, (Quantity * UnitPrice) as Sales_per_customer
from dbo.[OnlineRetail]
where (Quantity * UnitPrice) = (Select max(Quantity * UnitPrice) from dbo.[OnlineRetail]);

select InvoiceNo from dbo.[OnlineRetail]
where Quantity = (select max(Quantity) from dbo.[OnlineRetail]);


--Finding out the items purchased by CustomerID which has the Maximum sales as per Unit price
select InvoiceNo , StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID, 
Country, (Quantity * UnitPrice) as Sales_per_customer
from dbo.[OnlineRetail]
where CustomerID = 16446;

--Analyzing how much sales have been generated by each Customer ID
select CustomerID, sum(Quantity * UnitPrice)  as Sales_per_customer
from dbo.[OnlineRetail]
Group by CustomerID;

--Ordering the Total sales in descending order as per Customer ID
select CustomerID, sum(Quantity * UnitPrice)  as Sales_per_customer
from dbo.[OnlineRetail]
Group by CustomerID
Order by Sales_per_customer DESC;

--Ordering the Total sales in ascending order as per Customer ID
Select CustomerID , sum(Quantity * UnitPrice) as Sales_per_customer
from dbo.[OnlineRetail]
group by CustomerID
Order by Sales_per_customer ASC;

--Finding out how many Countries data do we have 
select distinct Country 
from dbo.[OnlineRetail];

select count( distinct Country)
from dbo.[OnlineRetail];--Total 38 countries


--Analyzing the data for United Kingdom 
select InvoiceNo, Stockcode,Description, (Quantity * UnitPrice) as Sales ,CustomerID, Country
From dbo.[OnlineRetail]
where country = 'United Kingdom';

--Analyzing sales generated by each country
select Country, sum(Quantity * UnitPrice) as Sales_per_country
from dbo.[OnlineRetail]
group by Country;

--Ordering sales generated by each country in Descending order
select Country, sum(Quantity * UnitPrice) as Sales_per_country
from dbo.[OnlineRetail]
group by Country
order by Sales_per_Country DESC;
--Top 5 Countries are UK, Netherlands, EIRE, Germany, France

--Ordering Sales generated by each country in Ascending order
select Country, sum(Quantity * UnitPrice) as Sales_per_country
from dbo.[OnlineRetail]
group by Country
order by Sales_per_Country ASC;
--Bottom 5 countries : Saudi Arabia, Bahrain, Czech Republic, Republic of South Africa & Brazil

--Creating stored procedure for Country
create procedure Country_Sale
as
begin
    Select Country, sum(Quantity * UnitPrice) as Sales_per_Country
	from dbo.[OnlineRetail]
	group by Country;
end;
Execute Country_Sale;
Exec Country_Sale;
Country_Sale;

--Create Stored Procedure for USA
CREATE PROCEDURE USA
AS
BEGIN
     SELECT InvoiceNo, StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID, Country
     from dbo.[OnlineRetail]
     where country  = 'USA';
END;

EXEC USA;

--Finding out which product has been ordered in maximum quantity
Select InvoiceNo, StockCode, Description, Quantity , InvoiceDate, UnitPrice, CustomerID, Country
from dbo.[OnlineRetail]
where  Quantity = (select max(Quantity) from dbo.[OnlineRetail]);

--Finding out which product has been ordered in minimum quantity
select InvoiceNo, StockCode,Description, Quantity , InvoiceDate, UnitPrice, CustomerID, Country
from dbo.[OnlineRetail]
where Quantity  = (Select min(Quantity) from dbo.[OnlineRetail]);

--This is giving us negative value

select count(InvoiceNo) from dbo.[OnlineRetail];

--Creating Stored Procedure to view the whole table
Create procedure Retail
As
Begin
     select * from dbo.[OnlineRetail];
end;

Retail;

--Using Transactions
BEGIN TRANSACTION
DELETE FROM dbo.[OnlineRetail] where CustomerID = 17850;

--Rolling back the Transaction
ROLLBACK TRANSACTION;

--This undo the changes made 
--Checking if the data for the ID = 17850 is in its original state
SELECT * FROM dbo.[OnlineRetail]
Where customerID = 17850;

--SavePoints in Transaction
BEGIN TRANSACTION

--1st Transaction to add a new Column
SAVE TRANSACTION X1
ALTER TABLE dbo.[OnlineRetail]
ADD SALES_PER_INVOICE INT;

--2nd Transaction to update the new column
SAVE TRANSACTION X2
UPDATE dbo.[OnlineRetail]
SET SALES_PER_INVOICE = (Quantity * UnitPrice);

--Rolling back the Transaction
 Retail;--New column Sales_per_Invoice can be seen

 Rollback Transaction X1;
 --Commit the Transaction
BEGIN TRANSACTION
--1st Transaction to add a new Column
SAVE TRANSACTION X1
ALTER TABLE dbo.[OnlineRetail]
ADD SALES_PER_INVOICE INT;

--2nd Transaction to update the new column
SAVE TRANSACTION X2
UPDATE dbo.[OnlineRetail]
SET SALES_PER_INVOICE = (Quantity * UnitPrice);

Commit;

-- Find the highest Sales_per_Invoice for all the countries 
select InvoiceNo, StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID,Country, Sales_Per_Invoice
from dbo.[OnlineRetail]
where Country = 'United Kingdom' and Sales_per_invoice = (select max(Sales_per_Invoice) from dbo.[OnlineRetail]
                                                 where Country = 'United Kingdom');

select InvoiceNo, StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID,Country, Sales_Per_Invoice
from dbo.[OnlineRetail]
where Country = 'France' and Sales_per_invoice = (select max(Sales_per_Invoice) from dbo.[OnlineRetail]
                                                 where Country = 'France');

--Minimum Sales per Invoice for Germany
select InvoiceNo, StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID,Country, Sales_Per_Invoice
from dbo.[OnlineRetail]
where Country = 'Germany' and Sales_per_invoice = (select min(Sales_per_Invoice) from dbo.[OnlineRetail]
                                                 where Country = 'Germany');
--Which product's Sales is Highest /Lowest
Select * from dbo.[OnlineRetail]
where Sales_per_Invoice =(select min(Sales_per_Invoice) from dbo.[OnlineRetail]);

Select * from dbo.[OnlineRetail]
order by SALES_PER_INVOICE;

Select * from dbo.[OnlineRetail]
where Sales_per_Invoice =(select max(Sales_per_Invoice) from dbo.[OnlineRetail]);

--Analysing Top 5 Sales_per_Invoice
Select TOP 5 InvoiceNo, StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID,Country, Sales_Per_Invoice
from dbo.[OnlineRetail] 
ORDER BY Sales_per_Invoice Desc;

--Analysing Bottom 5 Sales_per_Invoice
Select TOP 5 InvoiceNo, StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID,Country, Sales_Per_Invoice
from dbo.[OnlineRetail] 
ORDER BY Sales_per_Invoice ASC;


select InvoiceNo, StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID,Country, Sales_Per_Invoice
from dbo.[OnlineRetail] 
where Description = 'Adjust bad debt';

Select InvoiceNo, StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID,Country, Sales_Per_Invoice
from dbo.[OnlineRetail]
group by Description;

SELECT 
    InvoiceNo, 
    StockCode, 
    Description, 
    SUM(Quantity) AS TotalQuantity, 
    MAX(InvoiceDate) AS LatestInvoiceDate, 
    AVG(UnitPrice) AS AverageUnitPrice, 
    CustomerID, 
    Country
FROM dbo.[OnlineRetail]
GROUP BY Description, CustomerID, Country, InvoiceNo, StockCode;

--Creating a Table Company 
Create Table Company
(CustomerID VARCHAR (6),
Company_Name varchar (50),
Company_reviews int);

--Inserting data into Table
Insert into Company
Values 
     ('17850', 'Faber', 4),
     ('12583','Nastich', 3),
     ('14688','Hope',4),
	 ('15311','Six',2),
	 ('16098','Sigma',3),
	 ('18074','Gen',3),
	 ('17420','Rapo',2),
	 ('16029','Smuly',5),
	 ('16250','Raspy',3),
	 ('12431','Mahoba',2),
	 ('17511','Zenex',5),
	 ('17548','Switch',3),
	 ('13705','Flower',5),
	 ('13408','Soil',4);

--Adding a Column to an existing Table
ALTER TABLE COMPANY
ADD NET_WORTH_MN_DOLLAR INT;

create procedure Company_x
as
begin
    Select * from Company;
end;

Drop procedure Company;

Company_x;

update Company
set Net_WORTH_MN_DOLLAR = 212
Where CustomerID = '17850';

Company_x;

select distinct Country 
from dbo.[OnlineRetail];

Retail;
select * from Company;

--Inner Join to analyze specific Columns
select R1.CustomerID,C1.Company_Name, C1.Company_reviews, R1.Sales_per_invoice
from dbo.[OnlineRetail] as R1
INNER JOIN Company as C1
ON R1.CustomerID = C1.CustomerID;

SELECT C1.CustomerID, C1.Company_Name, C1.NET_WORTH_MN_DOLLAR, R1.STOCKCODE, R1.DESCRIPTION, R1.QUANTITY, R1.UNITPRICE
,R1.COUNTRY,R1.SALES_PER_INVOICE FROM dbo.[OnlineRetail] as R1
Right Join Company C1
on C1.CustomerID = R1.CustomerID;

SELECT C1.CustomerID, C1.Company_Name, C1.NET_WORTH_MN_DOLLAR, R1.STOCKCODE, R1.DESCRIPTION, R1.QUANTITY, R1.UNITPRICE
,R1.COUNTRY,R1.SALES_PER_INVOICE FROM dbo.[OnlineRetail] as R1
LEFT Join Company C1
on C1.CustomerID = R1.CustomerID;

SELECT C1.CustomerID, C1.Company_Name, C1.NET_WORTH_MN_DOLLAR, R1.STOCKCODE, R1.DESCRIPTION, R1.QUANTITY, R1.UNITPRICE
,R1.COUNTRY,R1.SALES_PER_INVOICE FROM dbo.[OnlineRetail] as R1
FULL Join Company C1
on C1.CustomerID = R1.CustomerID;

RETAIL;

select Top 5 InvoiceNo, StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID,Country, Sales_Per_Invoice
from dbo.[OnlineRetail] 
ORDER BY Sales_per_Invoice;

SELECT * FROM COMPANY 
WHERE COMPANY_REVIEWS >3;

UPDATE COMPANY
SET NET_WORTH_MN_DOLLAR = 190
WHERE CUSTOMERID = 12583

UPDATE COMPANY
SET NET_WORTH_MN_DOLLAR  = 225
WHERE CUSTOMERID = 14688;

UPDATE COMPANY
SET NET_WORTH_MN_DOLLAR  = 90
WHERE CUSTOMERID = 15311;

UPDATE COMPANY
SET NET_WORTH_MN_DOLLAR  = 160
WHERE CUSTOMERID = 16098;

UPDATE COMPANY
SET NET_WORTH_MN_DOLLAR  = 202
WHERE CUSTOMERID = 18074;

UPDATE COMPANY
SET NET_WORTH_MN_DOLLAR  = 85
WHERE CUSTOMERID = 17420;

UPDATE COMPANY
SET NET_WORTH_MN_DOLLAR  = 450
WHERE CUSTOMERID = 16029;

UPDATE COMPANY
SET NET_WORTH_MN_DOLLAR  = 137
WHERE CUSTOMERID = 16250;

UPDATE COMPANY
SET NET_WORTH_MN_DOLLAR  = 69
WHERE CUSTOMERID = 12431;

UPDATE COMPANY
SET NET_WORTH_MN_DOLLAR  = 460
WHERE CUSTOMERID = 17511;

UPDATE COMPANY
SET NET_WORTH_MN_DOLLAR  = 139
WHERE CUSTOMERID = 17548;

UPDATE COMPANY
SET NET_WORTH_MN_DOLLAR  = 460
WHERE CUSTOMERID = 13705;

UPDATE COMPANY
SET NET_WORTH_MN_DOLLAR  = 226
WHERE CUSTOMERID = 13408;

Retail;

--Creating VIEW
CREATE VIEW France
AS
  Select * from dbo.[OnlineRetail]
  where Country = 'France';

select * from France;

--Inserting data to view France
Insert into France
Values (111111, 22222, 'SPACEBOY LUNCH BOX', 20, '11-03-2011',2.2,12121, 'France', 44);
--This conversion was successful as we are inserting the data for Country France

Insert into France
Values (000000, 33333, 'SPACEBOY LUNCH BOX', 10, '21-03-2011',2.2,20202, 'Belgium', 22);

--Conversion failed because this view was created to enter the data for country France and not for Belgium

--Create View InvoiceNo, StockCode,Description, CustomerID, Sales_per_Invoice
Create View Sales
as
   Select InvoiceNo, StockCode, Description, CustomerID, Sales_per_Invoice
   from dbo.[OnlineRetail];

Select * from Sales;

Company_x;

--Create a Table which is the copy of another Table
WITH CompanyCopy AS (
    SELECT * FROM Company
)
SELECT * INTO Dup_Company FROM CompanyCopy;
select * from Dup_Company;

with OnlineRetailCopy as (
   Select * from dbo.[OnlineRetail]
   )
   Select * INTO DUP_OnlineRetail from OnlineRetailCopy;

--Finding out even nos of rows 
WITH NumberedRows AS (
    SELECT *, ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS RowNum
    FROM Company
)
SELECT *
FROM NumberedRows
WHERE RowNum % 2 = 0;

--Finding Odd num of rows
WITH ODDNUMROWS AS(
     SELECT *, ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS ROW_ODD
	 FROM COMPANY)
	 SELECT * FROM ODDNUMROWS WHERE ROW_ODD%2 != 0;

--Finding Nth row from a Table
Select * from dbo.[OnlineRetail]
Order by Quantity DESC limit 541910-1,1;

select count(*) from dbo.[OnlineRetail];

Retail;


















































